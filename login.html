<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>OlibaLife Registro</title>

<style>
  body {
    font-family: "Inter", sans-serif;
    background: #e9e9e8;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    margin: 0;
  }

  .login-box {
    background: #d0d0d0a9;
    padding: 30px 25px;
    border-radius: 12px;
    width: 360px;
    box-sizing: border-box;
  }

  h1, h2 {
    text-align: center;
    color: #005913;
  }

  h1 {
    font-size: 3rem;
    font-weight: 800;
    margin-bottom: 5px;
  }

  h2 {
    font-size: 1.4rem;
    font-weight: 600;
    margin-bottom: 15px;
  }

  input {
    width: 100%;
    padding: 12px 10px;
    margin-bottom: 10px;
    border: none;
    border-radius: 6px;
    font-size: 0.9rem;
  }

  button {
    width: 100%;
    padding: 12px;
    background-color: #004512;
    border: none;
    border-radius: 6px;
    color: #fff;
    font-weight: bold;
    font-size: 1rem;
    cursor: not-allowed;
    opacity: 0.5;
  }

  button.enabled {
    cursor: pointer;
    opacity: 1;
  }

  button.enabled:hover {
    background-color: #00aa00;
  }

  #errorMsg {
    margin-top: 8px;
    font-size: 0.9rem;
    text-align: center;
    min-height: 20px;
  }

  .rules {
    font-size: 0.8rem;
    margin: 10px 0;
  }

  .rule {
    display: flex;
    align-items: center;
    gap: 6px;
    color: #555;
  }

  .rule.ok {
    color: #008000;
  }

  .privacy {
    font-size: 0.8rem;
    color: #333;
    margin: 12px 0;
    display: flex;
    gap: 8px;
    align-items: flex-start;
  }

  .privacy input {
    margin-top: 3px;
  }

  .legal-text {
    font-size: 0.7rem;
    color: #555;
    text-align: center;
    margin-top: 8px;
  }

  /* ===== MODAL ===== */

  .modal {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.6);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 999;
  }

  .modal-content {
    background: #fff;
    padding: 25px 22px;
    border-radius: 14px;
    width: 90%;
    max-width: 360px;
    text-align: center;
    position: relative;
  }

  .close-modal {
    position: absolute;
    top: 10px;
    right: 14px;
    font-size: 1.2rem;
    cursor: pointer;
    color: #999;
  }

  .close-modal:hover {
    color: #000;
  }
</style>
</head>

<body>

<div class="login-box">
  <h1>OlibaLife</h1>
  <h2>Acceso a tu guía gratuita</h2>

  <input type="email" id="email" placeholder="Correo electrónico">
  <input type="password" id="password" placeholder="Contraseña segura">

  <div class="rules">
    <div id="ruleEmail" class="rule">❌ Correo electrónico válido</div>
    <div id="rulePassword" class="rule">❌ Contraseña segura</div>
    <div id="ruleConsent" class="rule">❌ Consentimiento aceptado</div>
  </div>

  <label class="privacy">
    <input type="checkbox" id="consent">
    Acepto recibir comunicaciones relacionadas con OlibaLife.
  </label>

  <div class="legal-text">
    Tus datos se usarán únicamente para ofrecerte contenidos y comunicaciones de OlibaLife.
    No compartimos ni vendemos tus datos a terceros.
  </div>

  <button id="login" disabled>Crear cuenta</button>
  <p id="errorMsg"></p>
</div>


<div id="guideModal" class="modal">
  <div class="modal-content">
    <div class="close-modal" id="closeModal">✕</div>
    <h2>¡Enhorabuena y gracias por confiar en OlibaLife!</h2>
      <h3>Estás un paso más cerca de tener una vida más saludabe. Tu guía de alimentación drenante está lista.</h3>
    <p>Descarga ya tu menú drenante gratis y siénte el poder de los alimentos.</p>
    <button id="downloadGuideBtn" class="enabled">Descargar guía</button>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>

<script>

  const PRODUCTS_URL = "https://test.olibalife.site/login.html"; 
  const firebaseConfig = {
    apiKey: "AIzaSyDtefk4GYIeR_0nwKthWql9CgYo7KkcYTo",
    authDomain: "olibalife-d8f41.firebaseapp.com",
    projectId: "olibalife-d8f41",
    appId: "1:901845518250:web:83b30373e275d827238dd3"
  };

  if (!firebase.apps.length) {
    firebase.initializeApp(firebaseConfig);
  }

  const auth = firebase.auth();

  const emailInput = document.getElementById("email");
  const passwordInput = document.getElementById("password");
  const consentCheckbox = document.getElementById("consent");
  const loginBtn = document.getElementById("login");
  const errorMsg = document.getElementById("errorMsg");

  const ruleEmail = document.getElementById("ruleEmail");
  const rulePassword = document.getElementById("rulePassword");
  const ruleConsent = document.getElementById("ruleConsent");

  function validate() {
    const emailValid = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(emailInput.value.trim());
    const passwordValid = /^(?=.*[A-Z])(?=.*\d)(?=.*[^A-Za-z0-9]).{8,}$/.test(passwordInput.value);
    const consentValid = consentCheckbox.checked;

    ruleEmail.className = emailValid ? "rule ok" : "rule";
    ruleEmail.textContent = emailValid ? "✅ Correo electrónico válido" : "❌ Correo electrónico válido";

    rulePassword.className = passwordValid ? "rule ok" : "rule";
    rulePassword.textContent = passwordValid
      ? "✅ Contraseña segura"
      : "❌ Mín. 8 caracteres, mayúscula, número y símbolo";

    ruleConsent.className = consentValid ? "rule ok" : "rule";
    ruleConsent.textContent = consentValid ? "✅ Consentimiento aceptado" : "❌ Consentimiento aceptado";

    loginBtn.disabled = !(emailValid && passwordValid && consentValid);
    loginBtn.classList.toggle("enabled", !loginBtn.disabled);
  }

  emailInput.addEventListener("input", validate);
  passwordInput.addEventListener("input", validate);
  consentCheckbox.addEventListener("change", validate);

  loginBtn.addEventListener("click", async () => {
    errorMsg.textContent = "";

    const email = emailInput.value.trim();
    const password = passwordInput.value;

    try {
      await auth.createUserWithEmailAndPassword(email, password);
      document.getElementById("guideModal").style.display = "flex";

    } catch (error) {
      console.error("Firebase Auth error:", error.code, error.message);

      switch (error.code) {
        case "auth/email-already-in-use":
          errorMsg.textContent = "Este correo ya está registrado. Prueba a iniciar sesión.";
          break;

        case "auth/invalid-email":
          errorMsg.textContent = "El correo electrónico no es válido.";
          break;

        case "auth/weak-password":
          errorMsg.textContent = "La contraseña es demasiado débil.";
          break;

        case "auth/operation-not-allowed":
          errorMsg.textContent = "El registro por email no está habilitado.";
          break;

        case "auth/network-request-failed":
          errorMsg.textContent = "Error de conexión. Revisa tu red.";
          break;

        case "auth/too-many-requests":
          errorMsg.textContent = "Demasiados intentos. Inténtalo más tarde.";
          break;

        default:
          errorMsg.textContent = "Error al crear la cuenta. Inténtalo de nuevo.";
      }
    }
  });

  function redirectToProducts() {
    window.location.href = PRODUCTS_URL;
  }

  document.getElementById("downloadGuideBtn").addEventListener("click", () => {
    const link = document.createElement("a");
    link.href = "https://test.olibalife.site/olibalifemenudrenante.pdf";
    link.download = "https://test.olibalife.site/olibalifemenudrenante.pdf";
    link.click();

    setTimeout(redirectToProducts, 1500);
  });

  document.getElementById("closeModal").addEventListener("click", redirectToProducts);
</script>

</body>
</html>
